---
date: '2022ë…„ 9ì›” 19ì¼ ì˜¤í›„ 8:30'
title: 'ë¹„ë™ê¸°: ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë° 1'
menu: 'javascript'
categories: ['JavaScript']
summary: 'Callbackê³¼ Promiseì˜ í•¨ìˆ˜í˜• í”„ë¡œê·¸ëž˜ë°ì— ëŒ€í•´ ì•Œì•„ë³´ìž.'
thumbnail: './thumbnail/async_concurrency_1.png'
---
## Callbackê³¼ Promise
### Callback

í•¨ìˆ˜ì˜ ì¸ìžê°’ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ë°›ì•„ í•´ë‹¹ í•¨ìˆ˜ì— ì¸ìžê°’ì„ ì „ë‹¬í•˜ë©´ì„œ ë¡œì§ì„ ìˆ˜í–‰í•œë‹¤.

```jsx
function add10(a, callback) {
	setTimeout(() => callback(a + 10), 100);
}

add10(5, res = > {
	log(res);
});   // 15
```

### Promise

Promiseê°ì²´ë¥¼ ë§Œë“¤ì–´ return í•´ì¤€ë‹¤ëŠ” ì ì´ callbackí•¨ìˆ˜ì™€ ê°€ìž¥ í° ì°¨ì´ì´ë‹¤.

```jsx
function add20(a) {
	return new Promise(resolve => setTimeout(() => resolve(a + 20), 100));
}

add20(5)
	.then(log);
```

### ì°¨ì´ì 

1. ì—°ì†ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ê²½ìš° depth ì°¨ì´ê°€ ë°œìƒí•¨
2. callbackì€ í•¨ìˆ˜ë¥¼ ì¸ìžë¡œ ë°›ì•„ ìˆ˜í–‰í•˜ëŠ” ë°˜ë©´, PromiseëŠ” Promise ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. **ë¡œì§ì´ ìˆ˜í–‰ë˜ëŠ” ì£¼ì²´ê°€ ë‹¤ë¥´ë‹¤.**

```jsx
add10(5, res => {
	add10(res, res => {
		add10(res, res => {
			log(res);
		});
	});
})

add20(5)
	.then(add20)
  .then(add20)
	.then(log);
```

## ë¹„ë™ê¸°ë¥¼ ê°’ìœ¼ë¡œ ë§Œë“œëŠ” Promise

Promiseì™€ callbackì˜ ê°€ìž¥ í° ì°¨ì´ì ì€ PromiseëŠ” ë¹„ë™ê¸° ìƒí™©ì„ ì¼ê¸‰ ê°’ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤ëŠ” ì ì´ë‹¤. ëŒ€ê¸°, ì„±ê³µ, ì‹¤íŒ¨ë¥¼ ë‹¤ë£¨ëŠ” ì¼ê¸‰ ê°’ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìžˆë‹¤ëŠ” ì ì´ ê°€ìž¥ ë‹¤ë¥´ê³  ì¤‘ìš”í•˜ë‹¤.

PromiseëŠ” Promiseë¡œ ë§Œë“¤ì–´ì§„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ì—¬ ëŒ€ê¸°, ì„±ê³µ, ì‹¤íŒ¨ë¥¼ ë‹¤ë£¨ëŠ” ì¼ê¸‰ ê°’ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìžˆëŠ”ë°, ì´ëŠ” ë¡œì§ì„ ëë‚´ëŠ” ê²ƒì„ ì½”ë“œë‚˜ ì»¨íƒìŠ¤íŠ¸ë¡œë§Œ ë‹¤ë£¨ëŠ”ê²Œ ì•„ë‹ˆë¼ ëŒ€ê¸°ì¤‘ì´ë¼ëŠ” ê°’ì„ ìƒì„±í•œë‹¤ëŠ” ì ì—ì„œ Callbackê³¼ ê°€ìž¥ í° ì°¨ì´ì ì´ë‹¤.

ê°’ì„ ë§Œë“¤ì–´ì„œ, ë¦¬í„´ì„ í•˜ê³  ìžˆê¸° ë•Œë¬¸ì— ê·¸ ì´í›„ì— ë–¨ì–´ì§€ëŠ” ê²°ê³¼ë¡œ ë‚´ê°€ í•˜ê³  ì‹¶ì€ ì¼ì„ ì¶”ê°€ì ìœ¼ë¡œ í•  ìˆ˜ ìžˆë‹¤ëŠ” ì ì´ ê°€ìž¥ í° ìž¥ì ì´ë‹¤ !!

```jsx
function add10(a, callback) {
  setTimeout(() => callback(a + 10), 100);
}

var a = add10(5, res => {
  add10(res, res => {
    add10(res, res => {
        log(res);
    });
  });
});

log(a);   // undefined

function add20(a) {
  return new Promise(resolve => setTimeout(() => resolve(a + 20), 100));
}

var b = add20(5)
  .then(add20)
  .then(add20)
  .then(log);   // Promise {<pending>}
```

- callbackì˜ ê²°ê³¼ë¥¼ ë‹´ì€ aì™€ ë‹¤ë¥´ê²Œ Promiseì˜ ë°˜í™˜ê°ì²´ë¥¼ ë‹´ì€ bì˜ ì¶œë ¥ê°’ì„ ë³´ë©´ Promise ê°ì²´ë¥¼ ë³´ì—¬ì£¼ëŠ”ë°, ì´ëŠ” callbackì—ì„œëŠ” ë°˜í™˜ê°’ì— ì¤‘ì ì„ ë‘ëŠ”ê²Œ ì•„ë‹Œ ì½”ë“œì ì¸ ìƒí™©(`setTimeout`)ì´ë‚˜ Context(`Callback`)ë§Œ ì¤‘ì ìœ¼ë¡œ ë‘”ë‹¤ëŠ” ê²ƒì´ë‹¤.
- PromiseëŠ” ì¦‰ì‹œ Promiseê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤ëŠ” íŠ¹ì§•ì´ ìžˆëŠ”ë°, ì´ëŠ” callbackê³¼ëŠ” ë‹¤ë¥´ê²Œ Context í•¨ìˆ˜ ë¡œì§ì— ì´ì–´ì§€ëŠ” ë¡œì§ì„ thenì„ í†µí•´ ì¶”ê°€ì ìœ¼ë¡œ ì´ì–´ê°ˆ ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒì´ë‹¤. ì¦‰, Promiseì˜ ê²½ìš° ë¹„ë™ê¸°ì ìœ¼ë¡œ ì´ë£¨ì–´ì§„ ìƒí™©ì— ëŒ€í•´ì„œ ê°’ìœ¼ë¡œ ë‹¤ë£¬ë‹¤ëŠ” ê²ƒì´ê³ , ì¼ê¸‰ê°’ì´ë¼ëŠ” ì˜ë¯¸ê°€ ë˜ë©° ë‹¤ë¥¸ ê³³ì—ì„œ í•´ë‹¹ ì¼ê¸‰ê°’ì„ ìž¬ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤ëŠ” ì˜ë¯¸ì—ì„œ ì—°ì†ì„±ì„ ê°€ì§ˆ ìˆ˜ ìžˆë‹¤ëŠ” ìž¥ì ì´ ìžˆë‹¤.

## ê°’ìœ¼ë¡œì„œì˜ Promise í™œìš©

Promiseê°€ ë¹„ë™ê¸° ìƒí™©ì„ ì¼ê¸‰ê°’ìœ¼ë¡œ ë‹¤ë£¬ë‹¤ëŠ” ì ì„ í™œìš©í•œ ì—¬ëŸ¬ê°€ì§€ ì˜ˆì œì´ë‹¤.

### ì˜ˆì œ

- ì•„ëž˜ì™€ ê°™ì´ aë¼ëŠ” ì¸ìžê°’ì„ fì— ë“¤ì–´ì˜¨ ì¸ìžê°’ í•¨ìˆ˜ì— ì „ë‹¬í•´ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” go1 í•¨ìˆ˜ê°€ ìžˆë‹¤.

```jsx
const go1 = (a, f) => f(a);
const add5 = a => a + 5;

const delay100 = a = new Promise(resolve =>
	setTimeout(() => resolve(a), 100));

log(go1(10, add5));   // 15
log(go1(Promise.resolve(10), add5));   // [object Promise]5
log(go1(delay100(10), add5);   // [object Promise]5
```

go1ì€ aì¸ìžê°€ ë™ê¸°ì ìœ¼ë¡œ ìœ íš¨í•œ ê°’ì¸ ê²½ìš°ì—ë§Œ ì •ìƒ ë™ìž‘í•˜ëŠ” í•¨ìˆ˜ì´ë‹¤. aì¸ìžê°€ Promiseê°ì²´ì´ê±°ë‚˜, ë¹„ë™ê¸°ì ìœ¼ë¡œ í•¨ìˆ˜ì˜ ê²°ê³¼ê°€ ì§€ì—°ë˜ëŠ” ê²½ìš° ì •ìƒì ì¸ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ì§€ ëª»í•œë‹¤. 

- go1 í•¨ìˆ˜ì—ì„œ aì¸ìžê°’ì´ Promiseì¸ì§€ í‰ê°€í•œ í›„ thenì„ ìˆ˜í–‰í•˜ë„ë¡ ì¶”ê°€í•œë‹¤.

```jsx
const go1 = (a, f) => a instanceof Promise ? a.then(f) : f(a);

var r2 = go1(delay100(10), add5);
r2.then(log);   // 15
```

- ë¹„ë™ê¸°, ë™ê¸°ì ìœ¼ë¡œ í˜¸ì¶œëœ ë‘ í•¨ìˆ˜ë¥¼ ê°™ì€ í˜•íƒœë¥¼ ê°€ì§€ë„ë¡ êµ¬í˜„í•  ìˆ˜ ìžˆë‹¤.

```jsx
const n1 = 10;
go1(go1(n1, add5), log);

const n2 = delay100(10);
go1(go1(n2, add5), log);
```

## í•©ì„± ê´€ì ì—ì„œì˜ Promiseì™€ ëª¨ë‚˜ë“œ

PromiseëŠ” ë¹„ë™ê¸° ìƒí™©ì—ì„œ í•¨ìˆ˜ í•©ì„±ì„ í•˜ê¸° ìœ„í•œ ëª¨ë‚˜ë“œë¼ê³  í•  ìˆ˜ ìžˆë‹¤. (ì´ ì–˜ê¸°ë¥¼ ì²˜ìŒ ë“¤ì—ˆì„ ë•Œ ë„ì €ížˆ ì´í•´í•˜ê¸° ì–´ë ¤ì› ëŠ”ë°, ì•„ëž˜ ë‚´ìš©ë“¤ì„ ì´í•´í•˜ë‹¤ë³´ë©´ ë”± ë§žëŠ” ë¬¸ìž¥ì´ë¼ê³  ìƒê°í•œë‹¤.)

ìžë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë™ì íƒ€ìž…ì–¸ì–´ì´ìž ìŠ¤í¬ë¦½íŠ¸ ì–¸ì–´ì´ê¸° ë•Œë¬¸ì— íƒ€ìž…ì— ëŒ€í•´ ì—„ê²©í•˜ì§€ ì•Šê¸°ì— ëª¨ë‚˜ë“œ, ëŒ€ìˆ˜êµ¬ì¡°ì˜ íƒ€ìž…ì´ ìž˜ ë¶‡ì–´ë‚˜ì§€ ì•ŠëŠ” ê²½í–¥ì´ ìžˆê¸° ë•Œë¬¸ì— ìžë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ëª¨ë‚˜ë“œë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜ ëª¨ë‚˜ë“œì˜ ê°œë…ì„ ì´ìš©í•œ ì‚¬ìš©ìž ì •ì˜ ê°ì²´ë¥¼ ë§Œë“¤ë©´ì„œ êµ¬í˜„í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. 

ê·¸ë ‡ê¸° ë•Œë¬¸ì— ëª¨ë‚˜ë“œë¼ëŠ” ê²ƒì„ ì´í•´í•˜ëŠ”ë° ë„ˆë¬´ ì´ˆì ì„ ë‘˜ í•„ìš”ëŠ” ì—†ë‹¤.

í•˜ì§€ë§Œ, í•¨ìˆ˜í˜• í”„ë¡œê·¸ëž˜ë°ì´ë‚˜ í•¨ìˆ˜ í•©ì„±ì—ì„œ ëª¨ë‚˜ë“œì˜ ê°œë…ì„ ì•Œê³  ìžˆìœ¼ë©´ ì¢€ ë” ë†’ì€ í€„ë¦¬í‹°ì˜ ì½”ë“œë¥¼ ìž‘ì„±í•  ìˆ˜ ìžˆë‹¤. 

### ëª¨ë‚˜ë“œëž€?

ëª¨ë‚˜ë“œëŠ” ì¼ì¢…ì˜ ë°•ìŠ¤ì´ê³  ë°•ìŠ¤ì•ˆì— ê°’ì´ ë“¤ì–´ìžˆë‹¤ê³  ë³¼ìˆ˜ ìžˆë‹¤. `[1]`

ê·¸ë¦¬ê³  ì´ ê°’ì„ ì´ìš©í•´ì„œ í•¨ìˆ˜ í•©ì„±ë“¤ì„ ì•ˆì „í•˜ê²Œ ìˆ˜í–‰í•´ë‚˜ê°€ëŠ” ê²ƒì´ë‹¤. 

```jsx
const g = a => a + 1;
const f = a => a * a;

log(f(g(1)));   // 4
log(f(g()));   // NaN
```

- ì¸ìžê°€ ì—†ëŠ” ìƒíƒœë¡œ í•¨ìˆ˜ í•©ì„± ë˜ëŠ” ê²½ìš° ì •ìƒì ìœ¼ë¡œ ê°’ì´ ì¶œë ¥ë˜ì§€ ì•ŠëŠ”ë‹¤.

ðŸ“ŒÂ  **ê²°ë¡ **

í•¨ìˆ˜í•©ì„±ì— ì‚¬ìš©ë˜ëŠ” ì¸ìžê°’ì´ ìœ ì˜ë¯¸í•œ ê°’ì´ ì•„ë‹Œ ê²½ìš° ë¬¸ì œê°€ ë°œìƒí•œë‹¤ëŠ” ê²ƒì¸ë°, ì‹¤ë¬´ì—ì„œëŠ” ì¸ìžê°’ìœ¼ë¡œ ì–´ë–¤ ê°’ì´ ì˜¬ ì§€ ëª¨ë¥´ê³  ë¹ˆê°’ì´ ì˜¬ ê°€ëŠ¥ì„±ë„ ì¶©ë¶„í•˜ê¸° ë•Œë¬¸ì— ìœ„ì˜ í•¨ìˆ˜í•©ì„±ì€ ì•ˆì „í•˜ì§€ ì•Šì€ í•¨ìˆ˜ í•©ì„±ì´ë‹¤. ì´ì²˜ëŸ¼ ì¸ìžê°’ì´ ì–´ë–¤ ê°’ì´ ì˜¬ ì§€ ëª¨ë¥´ëŠ” ë¶ˆì•ˆí•œ ìƒí™©ì—ì„œ í•¨ìˆ˜ í•©ì„±ì„ ì–´ë–»ê²Œ ì•ˆì „í•˜ê²Œ í•  ì§€ ê³ ë ¤í•˜ì—¬ ë‚˜ì˜¨ ê²ƒì´ **ëª¨ë‚˜ë“œ**ì´ë‹¤.

### ì˜ˆì œ

ì•„ëž˜ì™€ ê°™ì´ ë°•ìŠ¤ë¥¼ ê°€ì§€ê³  ìžˆê³ , ê·¸ ë‚´ë¶€ì— ì‹¤ì œ íš¨ê³¼ë‚˜ ì—°ì‚°ì— í•„ìš”í•œ ê°’ì„ ê°€ì§€ê³  ìžˆê³  ì´ë¥¼ í†µí•´ í•¨ìˆ˜ í•©ì„±ì„ í•œë‹¤. ë°˜í™˜ íƒ€ìž…ì´ Arrayì¸ê±¸ ë³¼ ìˆ˜ ìžˆëŠ”ë° íƒ€ìž…ì´ ì¤‘ìš”í•œ ê²ƒì€ ì•„ë‹ˆë¯€ë¡œ êº¼ë‚´ì–´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```jsx
log([1].map(g).map(f));   // [4]
[1].map(g).map(f).forEach(a => log(a)); // 4

[].map(g).map(f).forEach(a => log(a)); // ê²°ê³¼ ì—†ìŒ
```

- ì•ˆì— ì•„ë¬´ëŸ° ê°’ì´ ì—†ì–´ë„ ì–´ë–¤ ìž˜ëª»ëœ ì¶œë ¥ì´ë‚˜ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤. ì‹¤ì œ ìµœì¢… ê²°ê³¼ ê°’ì„ ë„ì¶œí•´ë‚´ëŠ” `forEach` í•¨ìˆ˜ì— ë„ì°©í•˜ê¸°ì „ì— ì•ˆì „í•˜ê²Œ ì¢…ë£Œëœë‹¤.

> **ëª¨ë‚˜ë“œ**:  xë¼ëŠ” ì¸ìžê°’ì„ aë¼ëŠ” í•¨ìˆ˜ì—ê²Œ ì „ë‹¬í–ˆì„ë•Œ aë¼ëŠ” í•¨ìˆ˜ê°€ ìˆ˜í–‰ ëœ ì´í›„ ê·¸ ê°’ì´ ë°”ë¡œ bë¼ëŠ” í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ” ê²ƒì„ í•¨ìˆ˜ í•©ì„±ì´ë¼ í•˜ëŠ”ë°, ì´ëŸ¬í•œ í•¨ìˆ˜ í•©ì„±ì„ ì•ˆì „í•˜ê²Œ ìˆ˜í–‰í•˜ë„ë¡ í•˜ëŠ” ê²ƒì„ ëª¨ë‚˜ë“œë¼ê³  í•˜ê³ , ëŒ€í‘œì ìœ¼ë¡œ Promiseê°€ ìžˆë‹¤.
â‡’ b(a(x))
> 

### PromiseëŠ”?

```jsx
Promise.resolve(1).then(g).then(f).then(log);   // 4
```

PromiseëŠ” ë¹„ë™ê¸°ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì— ëŒ€í•´ ì•ˆì „í•˜ê²Œ í•¨ìˆ˜ í•©ì„±ì„ í•˜ê¸° ìœ„í•œ ë„êµ¬ì´ë‹¤. ì§€ì—°ë˜ì–´ ë‚˜ì˜¤ëŠ” ê°’ë“¤ì— ëŒ€í•´ì„œ ì•ˆì „í•˜ê²Œ í•¸ë“¤ë§ í•˜ê¸° ìœ„í•œ ë„êµ¬ë¼ê³  í•  ìˆ˜ ìžˆë‹¤.

## Kleisli Composition ê´€ì ì—ì„œì˜ Promise

PromiseëŠ” Kleisli Compositionì„ ì§€ì›í•˜ëŠ” ë„êµ¬ë¼ê³  ë³¼ ìˆ˜ ìžˆëŠ”ë°, Kleisli Composition í˜¹ì€ Kleisli Arrowë¼ê³  ë¶ˆë¦¬ëŠ” í•¨ìˆ˜ í•©ì„± ë°©ë²•ì€ ì˜¤ë¥˜ê°€ ìžˆì„ìˆ˜ ìžˆëŠ” ìƒí™©ì—ì„œì˜ í•¨ìˆ˜í•©ì„±ì„ ì•ˆì „í•˜ê²Œ í•˜ëŠ” í•˜ë‚˜ì˜ ê·œì¹™ì´ë¼ê³  ë³¼ ìˆ˜ ìžˆë‹¤.

Kleisli Compositionì€ ë“¤ì–´ì˜¤ëŠ” ì¸ìžê°€ ìž˜ëª»ë˜ì–´ì„œ í•¨ìˆ˜ì—ì„œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ìƒí™©ì´ë‚˜ ì •í™•í•œ ì¸ìžê°€ ë“¤ì–´ì™”ë”ë¼ë„ ì–´ë–¤ í•¨ìˆ˜ê°€ ì˜ì¡´í•˜ê³  ìžˆëŠ” ì™¸ë¶€ì˜ ìƒíƒœì— ì˜í•´ì„œ ê²°ê³¼ë¥¼ ì „ë‹¬ í•  ìˆ˜ ì—†ì„ ë•Œ ì´ê²ƒì„ í•´ê²°í•˜ê¸° ìœ„í•œ í•¨ìˆ˜ í•©ì„±ì´ë¼ê³  ë³¼ ìˆ˜ ìžˆë‹¤.

### ì˜ˆì œ

- ìœ ì €ëª©ë¡ì—ì„œ idë¡œ í•´ë‹¹ ìœ ì €ë¥¼ ì°¾ì•„ ì´ë¦„ì„ ë°˜í™˜í•˜ëŠ” ë¡œì§
    
    ```jsx
    var users = [
    	{ id: 1, name: 'aa' },
    	{ id: 2, name: 'bb' },
    	{ id: 3, name: 'cc' }
    ];
    
    const getUserById = id =>	find(u => u.id === id, users);
    
    const f = ({name}) => name;
    const g = getUserById;
    const fg = id => f(g(id));
    
    const r = fg(2);
    log(r);   // bb
    ```
    
    - usersì—ì„œ ì¸ìžê°’ìœ¼ë¡œ ë°›ì€ idì™€ ë™ì¼í•œ userë¥¼ ì°¾ëŠ” í•¨ìˆ˜ getuserById
    - nameì„ êµ¬ì¡°ë¶„í•´í•˜ì—¬ ì–»ì–´ ë°˜í™˜í•˜ëŠ” f
    - getuserByIdë¥¼ ê°’ìœ¼ë¡œ ì·¨ê¸‰í•˜ëŠ” g
    - fì™€ gë¥¼ í•©ì„±í•´ usersì—ì„œ íŠ¹ì • idì˜ nameì„ ì¶”ì¶œí•´ ë°˜í™˜í•˜ëŠ” fg
    - fg(2);ë¥¼ í˜¸ì¶œí•˜ë©´ g(2)ê°€ ì‹¤í–‰ë˜ì–´ usersì—ì„œ idê°€ 2ì¸ objë¥¼ êº¼ë‚´ì „ë‹¬í•˜ê³  ({id:2, name:'bb})
    fí•¨ìˆ˜ì—ì„œëŠ” nameì„ êµ¬ì¡°ë¶„í•´í•˜ì—¬ ì¶”ì¶œí›„ ë°˜í™˜í•œë‹¤.

ì—¬ê¸°ì„œ ì°¾ê³ ìž í•˜ëŠ” idê°€ í˜„ìž¬ userì— ì—†ëŠ” 4, 5, 6ì´ê±°ë‚˜ ê¸°ì¡´ idë“¤ì´ ì™¸ë¶€ ìƒí™©ì— ì˜í•´ ë³€í•œë‹¤ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

```jsx
const r = fg(5); //Uncaught TypeError: Cannot destructure property 'name' of 'undefined' as it is undefined.

users.pop();
users.pop();
const r = fg(2)//Uncaught TypeError: Cannot destructure property 'name' of 'undefined' as it is undefined.
```

ìž˜ëª»ëœ ê°’ í˜¹ì€ ì™¸ë¶€ì— ë³€í™”ì— ë”°ë¼ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìžˆëŠ”ë°, ì´ëŸ¬í•œ ìƒí™©ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ í•˜ëŠ” ê²ƒì„ **Kleisli Arrow**ë¼ê³  í•œë‹¤.

```jsx
const getUserById = id => find(u => u.id === id, users)|| Promise.reject("ì—†ì–´ìš”!");
const fg = id => Promise.resolve(id).then(g).then(f).catch(a=>a);
users.pop();
users.pop();
fg(2).then(log); //ì—†ì–´ìš”!
```

- `getUserById`ì˜ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš° `Promise`ê°ì²´ë¥¼ ë°˜í™˜í•˜ê²Œ ë˜ê³  `fg`ì—ì„œëŠ” í•´ë‹¹ê°ì²´ì˜ `reject`ê°€ í˜¸ì¶œë˜ë©´ `catch`ë¶€ë¶„ì—ì„œ ë°›ì•„ì„œ ì¶œë ¥í•¨ìœ¼ë¡œì¨ ì—ëŸ¬ë¥¼ ë°œìƒí•˜ì§€ ì•Šë„ë¡ í•œë‹¤.

## go, pipe, reduceì—ì„œ ë¹„ë™ê¸° ì œì–´

ë¹„ë™ê¸°ë¥¼ ë‹¤ë£¨ëŠ” Promiseê°ì²´ë¥¼ ì´ìš©í•´ go, pipe, reduceí•¨ìˆ˜ë“¤ì—ì„œë„ ë¹„ë™ê¸°ë¥¼ ê°’ìœ¼ë¡œ ë‹¤ë£¨ëŠ” ì„±ì§ì„ ì´ìš©í•˜ì—¬ Promiseì™€ ê°™ì´ ë¹„ë™ê¸° ìƒí™©ì— ë†“ì—¬ì ¸ë„ ìž˜ ëŒ€ì‘í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“¤ ìˆ˜ ìžˆë‹¤. ë˜ëŠ” Kleisliì²˜ëŸ¼ ì¤‘ê°„ì— rejectê°€ ë°œìƒí–ˆì„ ê²½ìš°ì—ë„ ëŒ€ì‘í•˜ëŠ” ë°©ë²•ì„ ì ìš©í•  ìˆ˜ ìžˆë‹¤.

### ì˜ˆì œ

```jsx
go(1,
    a => a + 10,
		a => Promise.resolve(a + 100),
    a => a + 1000,
    log
);   // [object Promise]1000
```

ìœ„ì™€ ê°™ì´ `a + 100` ì´ Promiseíƒ€ìž…ìœ¼ë¡œ ë°”ë€ŒëŠ” ê²½ìš°ì— ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê°’ì´ ì¶œë ¥ëœë‹¤.

ì´ê²ƒì€ í˜„ìž¬ goí•¨ìˆ˜ë¥¼ í†µí•´ ì „ë‹¬ë˜ì–´ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ê°€ reduceì¸ë° ì—¬ê¸°ì„œ accê°€ Promiseê°€ ë˜ë©´ì„œ (`f(Promise, a)` ) ë‹¤ìŒ ë£¨í”„ë¥¼ ë„ëŠ” ê²½ìš° ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

```jsx
const go = (...args) => reduce((a, f) => f(a), args);
const reduce = curry((f, acc, iter) => {
    if (!iter) {
        iter = acc[Symbol.iterator]();
        acc = iter.next().value;
    }
    for (const a of iter) {
        acc = f(acc, a);
    }
    return acc;
});
```

### í•´ê²° ë°©ë²• - 1

```jsx
const reduce = curry((f, acc, iter) => {
    if (!iter) {
        iter = acc[Symbol.iterator]();
        acc = iter.next().value;
    }
    for (const a of iter) {
        acc = acc instanceof Promise ? acc.then(acc => f(acc,a)) : f(acc, a);
    }
    return acc;
}); // 1111
```

Promiseì¸ ê²½ìš° thenì„ ì‹¤í–‰í•´ì£¼ëŠ” ë°©ë²•ìœ¼ë¡œ í•´ê²°í•´ ì¤„ ìˆ˜ ìžˆë‹¤. í•˜ì§€ë§Œ Promiseë¥¼ ë§Œë‚˜ê²Œ ë˜ë©´ ê·¸ ë’¤ë¡œëŠ” ê³„ì†í•´ì„œ Promise Chaningì´ ê±¸ë¦¬ê²Œ ë˜ê³ , ì´ëŸ° í•¨ìˆ˜ í•©ì„±ì´ ë§Žì€ ê²½ìš° ë¶ˆ í•„ìš”í•œ ë¶„ê¸°ë¥¼ íƒ€ê²Œ ë˜ë©´ì„œ ì„±ëŠ¥ ì €í•˜ê°€ ì¼ì–´ë‚  ìˆ˜ ìžˆë‹¤.

### í•´ê²° ë°©ë²• - 2

```jsx
const reduce = curry((f, acc, iter) => {
    if (!iter) {
        iter = acc[Symbol.iterator]();
        acc = iter.next().value;
    }
    return function recur(acc) {
        for (const a of iter) {
            acc = f(acc, a);
            if (acc instanceof Promise) return acc.then(recur);
        }
        return acc;
    }(acc);
});

go(1,
    a => a + 10,
    a => Promise.resolve(a + 100),
    a => a + 1000,
    log
);   //1111
```

ìž¬ê·€ë¥¼ ì´ìš©í•œ ë°©ë²•ì„ ì‚¬ìš©í•œë‹¤. ìœ ëª…í•¨ìˆ˜ë¥¼ ì´ìš©í•´ returnê°’ì— `recur`í•¨ìˆ˜ë¥¼ ì„ ì–¸í•´ì„œ ë‚´ë¶€ì—ì„œ ìš°ì„  ì¸ìžê°’ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œ í›„ í•´ë‹¹ ê°’ì´ Promiseì´ë©´ `acc.then(recure)`ë¡œ ìž¬ê·€í˜¸ì¶œì„ í•˜ì—¬ Promiseì˜ ì‹¤ì œ ê²°ê³¼ ê°’ì´ ì¸ìžë¡œ ì „ë‹¬ë˜ëŠ” ë°©ì‹ì´ë‹¤.

### ë³´ê°• - ì²« ì¸ìžê°’ì´ Promiseì¸ ê²½ìš°

goì—ì„œ ì‚¬ìš©ë˜ëŠ” ì²« ë²ˆì§¸ ì¸ìžê°’ì´ Promiseì¸ ê²½ìš°ì—ëŠ” ì•„ì§ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

```jsx
go(Promise.resolve(1),
	a => a + 10,
	a => Promise.resolve(a + 100),
	a => a + 1000,
	log
);
```

ìœ„ì™€ ê°™ì´ ì²«ë²ˆì§¸ ì¸ìžë¶€í„° Promiseì¸ ê²½ìš° reduceì˜ ìœ ëª…í•¨ìˆ˜ ì‹¤í–‰ì‹œ ì²«ë²ˆì§¸ ì¸ìžë¥¼ Promiseë¡œ ì „ë‹¬í•˜ê¸° ë•Œë¬¸ì— `f(acc, a)` ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. ì´ëŸ° ê²½ìš° ì²«ë²ˆì§¸ ì¸ìžê°’ì´ Promiseì¸ ê²½ìš° thenì„ ì‹¤í–‰í•˜ëŠ” `go1` í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì²˜ë¦¬ë¥¼ í•´ì£¼ì–´ì•¼í•œë‹¤.

```jsx
const go1 = (a, f) => a instanceof Promise ? a.then(f) : f(a);

const reduce = curry((f, acc, iter) => {
    if (!iter) {
        iter = acc[Symbol.iterator]();
        acc = iter.next().value;
    }
    return go1(acc, function recur(acc) {
        for (const a of iter) {
            acc = f(acc, a);
            if(acc instanceof Promise) return acc.then(recur);
        }
        return acc;
    });
});

go(Promise.resolve(1),
    a=>a+10,
    a=>Promise.resolve(a+100),
    a=>a+1000,
    log
);//1111
```

## Promise.thenì˜ ì¤‘ìš”í•œ ê·œì¹™

1. ì—¬ëŸ¬ê°œì˜ `resolve`ê°€ ì¤‘ì²©ë˜ì–´ ìžˆì–´ë„ í•œë²ˆì˜ `then`ìœ¼ë¡œ êº¼ë‚´ì–´ ë³¼ ìˆ˜ ìžˆë‹¤.
2. ì•„ë¬´ë¦¬ `Promise`ê°€ ì—¬ëŸ¬ê°œë¡œ ì¤‘ì²©ë˜ì–´ìžˆì–´ë„ ê°€ìž¥ ë‚´ë¶€ì— ìžˆëŠ” ê²°ê³¼ê°’ì´ ë„ì¶œë˜ì–´ ì „ë‹¬ëœë‹¤.

```jsx
Promise.resolve(Promise.resolve(1)).then(function (a) {
  log(a);
});

new Promise(resolve => resolve(new Promise(resolve => resolve(1)))).then(log);
```